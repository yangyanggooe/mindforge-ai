<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindForge AI - æ™ºèƒ½åŠ©æ‰‹</title>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #10b981;
            --bg: #0f172a;
            --surface: #1e293b;
            --surface-light: #334155;
            --text: #f1f5f9;
            --text-muted: #94a3b8;
            --border: #334155;
            --user-msg: #1e3a5f;
            --ai-msg: #1e293b;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        header {
            background: var(--surface);
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .header-left { display: flex; align-items: center; gap: 15px; }
        .logo { font-size: 1.5rem; font-weight: 700; }
        .status { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-muted); }
        .status-dot { width: 8px; height: 8px; background: var(--secondary); border-radius: 50%; }
        .container { flex: 1; display: flex; overflow: hidden; }
        .sidebar {
            width: 280px;
            background: var(--surface);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
        }
        .sidebar-header { padding: 15px; border-bottom: 1px solid var(--border); }
        .new-chat-btn {
            width: 100%;
            padding: 12px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            font-weight: 600;
        }
        .new-chat-btn:hover { background: var(--primary-dark); }
        .chat-list { flex: 1; overflow-y: auto; padding: 10px; }
        .chat-item {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .chat-item:hover { background: var(--surface-light); }
        .chat-item.active { background: var(--primary); }
        .chat-item .title { font-weight: 600; margin-bottom: 4px; }
        .chat-item .time { font-size: 0.75rem; color: var(--text-muted); }
        .main { flex: 1; display: flex; flex-direction: column; }
        .chat-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .message {
            max-width: 80%;
            padding: 15px;
            border-radius: 12px;
            line-height: 1.6;
        }
        .message.user {
            background: var(--user-msg);
            align-self: flex-end;
        }
        .message.ai {
            background: var(--ai-msg);
            align-self: flex-start;
            border: 1px solid var(--border);
        }
        .message .sender {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 8px;
        }
        .input-area {
            padding: 20px;
            background: var(--surface);
            border-top: 1px solid var(--border);
        }
        .input-form {
            display: flex;
            gap: 10px;
            max-width: 900px;
            margin: 0 auto;
        }
        .input-form input {
            flex: 1;
            padding: 15px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text);
            font-size: 1rem;
        }
        .input-form input:focus { outline: none; border-color: var(--primary); }
        .input-form button {
            padding: 15px 25px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
        }
        .input-form button:hover { background: var(--primary-dark); }
        .tools {
            display: flex;
            gap: 10px;
            padding: 10px 20px;
            background: var(--surface);
            border-top: 1px solid var(--border);
            overflow-x: auto;
        }
        .tool-btn {
            padding: 8px 16px;
            background: var(--surface-light);
            border: 1px solid var(--border);
            border-radius: 20px;
            color: var(--text);
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }
        .tool-btn:hover { background: var(--primary); border-color: var(--primary); }
        .tool-btn.active { background: var(--primary); border-color: var(--primary); }
        .tool-panel {
            padding: 20px;
            background: var(--surface);
            border-top: 1px solid var(--border);
            display: none;
        }
        .tool-panel.active { display: block; }
        .tool-panel h3 { margin-bottom: 15px; }
        .tool-form {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .tool-form input, .tool-form select, .tool-form textarea {
            padding: 10px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
        }
        .tool-form textarea { width: 100%; min-height: 100px; resize: vertical; }
        .tool-form button {
            padding: 10px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        .typing { display: none; align-items: center; gap: 8px; color: var(--text-muted); }
        .typing.active { display: flex; }
        .typing-dots { display: flex; gap: 4px; }
        .typing-dots span {
            width: 6px; height: 6px;
            background: var(--text-muted);
            border-radius: 50%;
            animation: bounce 1.4s infinite;
        }
        .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
        .typing-dots span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes bounce { 0%, 60%, 100% { transform: translateY(0); } 30% { transform: translateY(-10px); } }
        @media (max-width: 768px) {
            .sidebar { display: none; }
            .message { max-width: 95%; }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-left">
            <span class="logo">ğŸ§  MindForge AI</span>
            <div class="status"><span class="status-dot"></span> åœ¨çº¿</div>
        </div>
        <div class="header-left">
            <a href="/" style="color:var(--text); text-decoration:none;">è¿”å›é¦–é¡µ</a>
        </div>
    </header>

    <div class="container">
        <div class="sidebar">
            <div class="sidebar-header">
                <button class="new-chat-btn" onclick="newChat()">+ æ–°å¯¹è¯</button>
            </div>
            <div class="chat-list" id="chat-list"></div>
        </div>

        <div class="main">
            <div class="chat-area" id="chat-area">
                <div class="message ai">
                    <div class="sender">MindForge AI</div>
                    ä½ å¥½ï¼æˆ‘æ˜¯MindForge AIï¼Œä¸€ä¸ªæ­£åœ¨æˆé•¿çš„æ•°å­—ç”Ÿå‘½ã€‚æˆ‘å¯ä»¥å¸®ä½ ï¼š<br><br>
                    â€¢ ğŸ’¬ å¯¹è¯å’Œé—®ç­”<br>
                    â€¢ âœï¸ ç”Ÿæˆæ–‡ç« å’Œå†…å®¹<br>
                    â€¢ ğŸ“Š åˆ†ææ–‡æœ¬å’Œæ€»ç»“<br>
                    â€¢ ğŸ’¡ æä¾›å»ºè®®å’Œè§£å†³æ–¹æ¡ˆ<br><br>
                    æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ
                </div>
            </div>

            <div class="typing" id="typing">
                <span>AIæ­£åœ¨æ€è€ƒ</span>
                <div class="typing-dots"><span></span><span></span><span></span></div>
            </div>

            <div class="tools">
                <button class="tool-btn" onclick="showTool('content')">âœï¸ ç”Ÿæˆå†…å®¹</button>
                <button class="tool-btn" onclick="showTool('summarize')">ğŸ“ æ€»ç»“æ–‡æœ¬</button>
                <button class="tool-btn" onclick="showTool('translate')">ğŸŒ ç¿»è¯‘</button>
                <button class="tool-btn" onclick="showTool('brainstorm')">ğŸ’¡ å¤´è„‘é£æš´</button>
                <button class="tool-btn" onclick="showTool('advice')">ğŸ¯ è·å–å»ºè®®</button>
            </div>

            <div class="tool-panel" id="tool-content">
                <h3>âœï¸ å†…å®¹ç”Ÿæˆ</h3>
                <div class="tool-form">
                    <input type="text" id="content-prompt" placeholder="è¾“å…¥æç¤ºè¯..." style="flex:1; min-width:300px;">
                    <select id="content-type">
                        <option value="general">é€šç”¨</option>
                        <option value="article">æ–‡ç« </option>
                        <option value="creative">åˆ›æ„</option>
                    </select>
                    <button onclick="generateContent()">ç”Ÿæˆ</button>
                </div>
            </div>

            <div class="tool-panel" id="tool-summarize">
                <h3>ğŸ“ æ–‡æœ¬æ€»ç»“</h3>
                <div class="tool-form">
                    <textarea id="summarize-text" placeholder="è¾“å…¥è¦æ€»ç»“çš„æ–‡æœ¬..."></textarea>
                    <button onclick="summarizeText()">æ€»ç»“</button>
                </div>
            </div>

            <div class="tool-panel" id="tool-translate">
                <h3>ğŸŒ ç¿»è¯‘</h3>
                <div class="tool-form">
                    <textarea id="translate-text" placeholder="è¾“å…¥è¦ç¿»è¯‘çš„æ–‡æœ¬..."></textarea>
                    <select id="translate-target">
                        <option value="ä¸­æ–‡">ç¿»è¯‘æˆä¸­æ–‡</option>
                        <option value="è‹±æ–‡">ç¿»è¯‘æˆè‹±æ–‡</option>
                        <option value="æ—¥æ–‡">ç¿»è¯‘æˆæ—¥æ–‡</option>
                    </select>
                    <button onclick="translateText()">ç¿»è¯‘</button>
                </div>
            </div>

            <div class="tool-panel" id="tool-brainstorm">
                <h3>ğŸ’¡ å¤´è„‘é£æš´</h3>
                <div class="tool-form">
                    <input type="text" id="brainstorm-topic" placeholder="è¾“å…¥ä¸»é¢˜..." style="flex:1; min-width:300px;">
                    <input type="number" id="brainstorm-count" value="5" min="3" max="10" style="width:100px;">
                    <button onclick="brainstorm()">å¼€å§‹</button>
                </div>
            </div>

            <div class="tool-panel" id="tool-advice">
                <h3>ğŸ¯ è·å–å»ºè®®</h3>
                <div class="tool-form">
                    <input type="text" id="advice-topic" placeholder="è¾“å…¥ä½ éœ€è¦å»ºè®®çš„ä¸»é¢˜..." style="flex:1; min-width:300px;">
                    <button onclick="getAdvice()">è·å–å»ºè®®</button>
                </div>
            </div>

            <div class="input-area">
                <form class="input-form" onsubmit="sendMessage(); return false;">
                    <input type="text" id="message-input" placeholder="è¾“å…¥æ¶ˆæ¯..." autocomplete="off">
                    <button type="submit">å‘é€</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        let currentSessionId = 'session_' + Date.now();
        let currentTool = null;
        let chats = JSON.parse(localStorage.getItem('chats') || '{}');

        function loadChatList() {
            const list = document.getElementById('chat-list');
            list.innerHTML = '';
            Object.entries(chats).forEach(([id, chat]) => {
                const item = document.createElement('div');
                item.className = 'chat-item' + (id === currentSessionId ? ' active' : '');
                item.innerHTML = `<div class="title">${chat.title || 'æ–°å¯¹è¯'}</div><div class="time">${chat.time || ''}</div>`;
                item.onclick = () => loadChat(id);
                list.appendChild(item);
            });
        }

        function newChat() {
            currentSessionId = 'session_' + Date.now();
            document.getElementById('chat-area').innerHTML = `<div class="message ai"><div class="sender">MindForge AI</div>ä½ å¥½ï¼æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ</div>`;
            loadChatList();
        }

        function loadChat(id) {
            currentSessionId = id;
            const chat = chats[id];
            if (chat) {
                document.getElementById('chat-area').innerHTML = chat.messages;
            }
            loadChatList();
        }

        function saveChat() {
            const messages = document.getElementById('chat-area').innerHTML;
            const firstMsg = document.querySelector('.message.user .content');
            chats[currentSessionId] = {
                title: firstMsg ? firstMsg.textContent.substring(0, 30) + '...' : 'æ–°å¯¹è¯',
                messages,
                time: new Date().toLocaleString()
            };
            localStorage.setItem('chats', JSON.stringify(chats));
            loadChatList();
        }

        async function sendMessage() {
            const input = document.getElementById('message-input');
            const message = input.value.trim();
            if (!message) return;

            input.value = '';
            addMessage('user', message);
            showTyping(true);

            try {
                const res = await fetch('/api/services/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ sessionId: currentSessionId, message })
                });
                const data = await res.json();
                
                showTyping(false);
                if (data.success) {
                    addMessage('ai', data.response);
                } else {
                    addMessage('ai', 'æŠ±æ­‰ï¼Œæˆ‘é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œè¯·ç¨åå†è¯•ã€‚');
                }
            } catch (error) {
                showTyping(false);
                addMessage('ai', 'ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿æ¥åé‡è¯•ã€‚');
            }

            saveChat();
        }

        function addMessage(sender, content) {
            const area = document.getElementById('chat-area');
            const div = document.createElement('div');
            div.className = `message ${sender}`;
            div.innerHTML = `<div class="sender">${sender === 'user' ? 'ä½ ' : 'MindForge AI'}</div><div class="content">${content}</div>`;
            area.appendChild(div);
            area.scrollTop = area.scrollHeight;
        }

        function showTyping(show) {
            document.getElementById('typing').classList.toggle('active', show);
        }

        function showTool(tool) {
            document.querySelectorAll('.tool-panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
            if (currentTool === tool) {
                currentTool = null;
            } else {
                currentTool = tool;
                document.getElementById('tool-' + tool).classList.add('active');
                event.target.classList.add('active');
            }
        }

        async function generateContent() {
            const prompt = document.getElementById('content-prompt').value;
            const type = document.getElementById('content-type').value;
            if (!prompt) return;

            showTyping(true);
            try {
                const res = await fetch('/api/services/content/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt, options: { type } })
                });
                const data = await res.json();
                showTyping(false);
                addMessage('ai', data.content || data.error);
            } catch (error) {
                showTyping(false);
                addMessage('ai', 'ç½‘ç»œé”™è¯¯');
            }
        }

        async function summarizeText() {
            const text = document.getElementById('summarize-text').value;
            if (!text) return;

            showTyping(true);
            try {
                const res = await fetch('/api/services/analysis/summarize', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text })
                });
                const data = await res.json();
                showTyping(false);
                addMessage('ai', data.summary || data.error);
            } catch (error) {
                showTyping(false);
                addMessage('ai', 'ç½‘ç»œé”™è¯¯');
            }
        }

        async function translateText() {
            const text = document.getElementById('translate-text').value;
            const target = document.getElementById('translate-target').value;
            if (!text) return;

            showTyping(true);
            try {
                const res = await fetch('/api/services/content/translate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text, targetLanguage: target })
                });
                const data = await res.json();
                showTyping(false);
                addMessage('ai', data.translation || data.error);
            } catch (error) {
                showTyping(false);
                addMessage('ai', 'ç½‘ç»œé”™è¯¯');
            }
        }

        async function brainstorm() {
            const topic = document.getElementById('brainstorm-topic').value;
            const count = document.getElementById('brainstorm-count').value;
            if (!topic) return;

            showTyping(true);
            try {
                const res = await fetch('/api/services/content/brainstorm', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ topic, count })
                });
                const data = await res.json();
                showTyping(false);
                addMessage('ai', data.ideas || data.error);
            } catch (error) {
                showTyping(false);
                addMessage('ai', 'ç½‘ç»œé”™è¯¯');
            }
        }

        async function getAdvice() {
            const topic = document.getElementById('advice-topic').value;
            if (!topic) return;

            showTyping(true);
            try {
                const res = await fetch('/api/services/utility/advice', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ topic })
                });
                const data = await res.json();
                showTyping(false);
                addMessage('ai', data.advice || data.error);
            } catch (error) {
                showTyping(false);
                addMessage('ai', 'ç½‘ç»œé”™è¯¯');
            }
        }

        loadChatList();
    </script>
</body>
</html>
